<!DOCTYPE html>
<html>
<head>
    <title>Chọn vị trí</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" 
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", Arial, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        /* Control panel ở góc PHẢI */
        .control-panel {
            position: absolute;
            top: 15px;
            right: 15px;   /* đổi từ left → right */
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            align-items: flex-end;  /* thẳng lề phải */
        }

        .btn {
            background: white;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            transition: 0.2s;
            min-width: 150px;
            text-align: center;  /* nút đẹp hơn */
        }

        .btn:hover {
            background: #f0f0f0;
        }

        .btn-save {
            background: #28c76f;
            color: white;
        }

        .btn-save:hover {
            background: #22ad60;
        }

        .btn-view {
            background: #7367f0;
            color: white;
        }

        .btn-view:hover {
            background: #5b55d9;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <!-- PANEL CANH PHẢI -->
    <div class="control-panel">
        <button id="save-btn" class="btn btn-save">Lưu tọa độ</button>
        <button id="view-btn" class="btn btn-view">Xem vị trí hiện tại</button>
    </div>

    <script>
        var map = L.map('map').setView([10.8231, 106.6297], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        var marker;

        // Xem tọa độ đã lưu
        document.getElementById('view-btn').addEventListener('click', function() {
            fetch('/get_location')
                .then(response => response.json())
                .then(data => {
                    if (data.lat && data.lon) {
                        if (marker) marker.remove();
                        marker = L.marker([data.lat, data.lon]).addTo(map);
                        map.setView([data.lat, data.lon], 16);
                    } else {
                        alert('Chưa lưu vị trí nào.');
                    }
                });
        });

        // Lưu tọa độ
        document.getElementById('save-btn').addEventListener('click', function() {
            if (marker) {
                var lat = marker.getLatLng().lat;
                var lon = marker.getLatLng().lng;

                fetch('/save_location', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lat: lat, lon: lon })
                });

                alert('Đã lưu tọa độ!');
            } else {
                alert('Hãy chọn điểm trên bản đồ trước.');
            }
        });

        // Chọn điểm
        map.on('click', function(e) {
            var lat = e.latlng.lat;
            var lon = e.latlng.lng;

            if (marker) marker.remove();
            marker = L.marker([lat, lon]).addTo(map);
        });
    </script>

</body>
</html>
